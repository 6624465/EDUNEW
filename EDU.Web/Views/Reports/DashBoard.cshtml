@model EDU.Web.ViewModels.ReportsModel.ProductRevenueReportVM

@{
    ViewBag.Title = "DashBoard";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var productTotalRevenueByMonth = Model.productTotalRevenueByMonth;
    var productRevenueByMonth = Model.productRevenueByMonth;

    decimal? totalrevenue = 0;
    decimal? achievedtotal = 0;
    decimal? yettoachieve = 0;

    foreach (var item in productRevenueByMonth)
    {
        totalrevenue += item.TotalRevenue;
        achievedtotal += item.JanAmount + item.FebAmount + item.MarAmount + item.AprAmount + item.MayAmount + item.JuneAmount +
            item.JulyAmount + item.AugAmount + item.SepAmount + item.OctAmount + item.NovAmount + item.DecAmount;
    }
    yettoachieve = totalrevenue - achievedtotal;
}
@section StylesCharts{
    <link href="http://circle.firchow.net/assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="http://circle.firchow.net/assets/css/circle.css">
}

@{
    var listMonths = new List<SelectListItem>()
    {
    new SelectListItem {Text = "Select Month",   Value = "0"},
    new SelectListItem {Text = "Janaury",   Value = "1"},
    new SelectListItem {Text = "February", Value = "2"},
    new SelectListItem {Text = "March", Value = "3"},
    new SelectListItem {Text = "April",   Value = "4"},
    new SelectListItem {Text = "May", Value = "5"},
    new SelectListItem {Text = "June", Value = "6"},
    new SelectListItem {Text = "July",   Value = "7"},
    new SelectListItem {Text = "August", Value = "8"},
    new SelectListItem {Text = "September", Value = "9"},
    new SelectListItem {Text = "October",   Value = "10"},
    new SelectListItem {Text = "November", Value = "11"},
    new SelectListItem {Text = "December", Value = "12"}
    };


}
<div class="page page-forms-elements">
    <div class="page-wrap">
        <div class="panel panel-default">
            <div class="box" id="grid">
                <div class="box-header">
                    <h4>DashBoard - Achievement  YTD</h4>
                    <div class="box-tools">
                    </div>
                </div>
                <div class="box-body">
                    <div class="col-md-12">
                        <div class="row css10">
                            <div class="form-group">
                                <div class="col-md-2">
                                    @Html.DropDownListFor(x => x.productTotalRevenueByMonth.FirstOrDefault().Country,
                                     new SelectList((List<EZY.EDU.Contract.Branch>)ViewData["CountryData"], "BranchId", "BranchName"),
                                     "Select Country", new { @class = "form-control input-sm", onchange = "ChangeMonth();" })
                                </div>
                                <label class="col-md-1 control-label">
                                    <span class="pull-right">Month</span>
                                </label>
                                <div class="col-md-2">
                                    @Html.DropDownListFor(x => x.productTotalRevenueByMonth.FirstOrDefault().Month, listMonths, new { @class = "form-control input-sm", onchange = "ChangeMonth(this);" })
                                </div>
                                <label class="col-md-1 control-label">
                                    <span class="pull-right">Year</span>
                                </label>
                                <div class="col-md-2">
                                    @Html.DropDownListFor(x => x.productTotalRevenueByMonth.FirstOrDefault().Year, Enumerable.Range(2017, 14).Select(i => new SelectListItem { Text = i.ToString(), Value = i.ToString() }), "Select Year ", new { @class = "form-control input-sm", onchange = "ChangeMonth();" })
                                </div>
                            </div>
                        </div>

                        <div class="row css10">
                            <div class="col-md-12">
                                <div class="col-md-7">
                                    <div class="row">
                                        <div class="pull-left">
                                            <div class="c100 p100 center">
                                                <span>100%</span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                            <p class="text-center"><em><span id="Prod0"></span></em></p>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 p100 center green">
                                                <span>100%</span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                            <p class="text-center"><em><span id="Prod1"></span></em></p>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 p100 center orange">
                                                <span>100%</span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                            <p class="text-center"><em><span id="Prod2"></span></em></p>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 p100 center red">
                                                <span>100%</span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                            <p class="text-center"><em><span id="Prod3"></span></em></p>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 p100 center orange">
                                                <span>100%</span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                            <p class="text-center"><em><span id="Prod4"></span></em></p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="pull-left">
                                            <div class="c100 center" id="div0">
                                                <span id="achieved0"></span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 center green" id="div1">
                                                <span id="achieved1"></span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 center orange" id="div2">
                                                <span id="achieved2"></span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 center red" id="div3">
                                                <span id="achieved3"></span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                        </div>
                                        <div class="pull-left">
                                            <div class="c100 center orange" id="div4">
                                                <span id="achieved4"></span>
                                                <div class="slice"><div class="bar"></div><div class="fill"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div id="chartContainer5" style="height: 370px; width: 100%;"></div>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="row" style="padding-top:5%">
                                        <div id="chartContainer0" style="height: 120px; width: 100%;"></div>
                                    </div>
                                    <div class="row" style="padding-top:5%">
                                        <div id="chartContainer1" style="height: 120px; width: 100%;"></div>
                                    </div>
                                    <div class="row" style="padding-top:5%">
                                        <div id="chartContainer2" style="height: 120px; width: 100%;"></div>
                                    </div>
                                    <div class="row" style="padding-top:5%">
                                        <div id="chartContainer3" style="height: 120px; width: 100%;"></div>
                                    </div>
                                    <div class="row" style="padding-top:5%">
                                        <div id="chartContainer4" style="height: 120px; width: 100%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="padding-top:5%">
                            <div class="col-md-4">
                                <table class="table-responsive" style="width:100%" border="2">
                                    <thead>
                                        <tr style="background:blue;color:white">
                                            <th style="width:25%">PRODUCT</th>
                                            <th style="width:25%">GOAL</th>
                                            <th style="width:25%">ACHIEVED</th>
                                            <th style="width:25%">%</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var it in productRevenueByMonth)
                                        {
                                            decimal? amt = it.JanAmount + it.FebAmount + it.MarAmount + it.AprAmount + it.MayAmount + it.JuneAmount + it.JulyAmount + it.AugAmount + it.SepAmount + it.OctAmount + it.NovAmount + it.DecAmount;
                                            decimal? percent = amt / (it.TotalRevenue * 100);
                                            <tr>
                                                <th>@it.ProductName</th>
                                                <th>@it.TotalRevenue.Value.ToString("#0.00")</th>
                                                <th>@amt.Value.ToString("#0.00")</th>
                                                <th>@percent.Value.ToString("#0.00")%</th>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-md-8">
                                <table class="table-responsive" style="width:100%" border="2">
                                    <thead>
                                        <tr style="background:blue;color:white">
                                            <th style="width:25%">PRODUCT</th>
                                            <th>JAN</th>
                                            <th>FEB</th>
                                            <th>MAR</th>
                                            <th>APR</th>
                                            <th>MAY</th>
                                            <th>JUN</th>
                                            <th>JUL</th>
                                            <th>AUG</th>
                                            <th>SET</th>
                                            <th>OCT</th>
                                            <th>NOV</th>
                                            <th>DEC</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var itm in productRevenueByMonth)
                                        {
                                            <tr>
                                                <th>@itm.ProductName</th>
                                                <th>@itm.JanAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.FebAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.MarAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.AprAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.MayAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.JuneAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.JulyAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.AugAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.SepAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.OctAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.NovAmount.Value.ToString("#0.00")</th>
                                                <th>@itm.DecAmount.Value.ToString("#0.00")</th>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section SectionScripts {
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script type="text/javascript">
        function ChangeMonth() {
            window.location = '@Url.Action("Dashboard", "Reports", new { month = "", year = "", country="" })' + '?country=' + $('#Country').val() + "&month=" + $('#Month').val() + "&year=" + $('#Year').val();
        };

        $(document).ready(function () {
            $('#liReportsDashboard').addClass('active');

            var count = 0;
            @foreach(var item in productTotalRevenueByMonth)
            {
            <text>
                var achievedPercent = @item.TotalRevenue>0?((@item.AchievedRevenue * 100) / @item.TotalRevenue):0;
                $('#achieved' + count).text(achievedPercent.toFixed(2) + '%');

                $('#Prod' + count).text('@item.ProductName');
                $('#div' + count).addClass('p' + parseInt(achievedPercent));
                count++;
            </text>
            }

        });
        var count = 0;
        @foreach (var item in productRevenueByMonth)
        {
        <text>
        var chart = new CanvasJS.Chart("chartContainer" + count, {
            theme: "light2", // "light1", "light2", "dark1", "dark2"
            animationEnabled: true,
            title:{
                text: '@item.ProductName'
            },
            axisX: {
                interval: 1,
                intervalType: "month",
                valueFormatString: "MMM"
            },
            axisY:{
                title: "",
                valueFormatString: "$#0",
                stripLines: [{
                    value: @item.MonthlyTarget,
                    label: '@item.MonthlyTarget.Value.ToString("#0.00")'
                }],
                maximum: (@item.TotalRevenue)/9,
            },
            data: [{
                type: "line",
                markerSize: 12,
                xValueFormatString: "MMM, YYYY",
                yValueFormatString: "$###.#",
                dataPoints: [
                    { x: new Date(@item.Year, 00, 1), y: @item.JanAmount },
                    { x: new Date(@item.Year, 01, 1), y: @item.FebAmount },
                    { x: new Date(@item.Year, 02, 1), y: @item.MarAmount },
                    { x: new Date(@item.Year, 03, 1), y: @item.AprAmount },
                    { x: new Date(@item.Year, 04, 1), y: @item.MayAmount },
                    { x: new Date(@item.Year, 05, 1), y: @item.JuneAmount },
                    { x: new Date(@item.Year, 06, 1), y: @item.JulyAmount },
                    { x: new Date(@item.Year, 07, 1), y: @item.AugAmount },
                    { x: new Date(@item.Year, 08, 1), y: @item.SepAmount },
                    { x: new Date(@item.Year, 09, 1), y: @item.OctAmount },
                    { x: new Date(@item.Year, 10, 1), y: @item.NovAmount },
                    { x: new Date(@item.Year, 11, 1), y: @item.DecAmount }
                ]
                }]
            });
        chart.render();
        count++;
        </text>
        }


        var chart5 = new CanvasJS.Chart("chartContainer5", {
            animationEnabled: true,
            title: {
                text: 'Total Revenue - @totalrevenue.Value.ToString("#0.00")'
            },
            data: [{
                type: "pie",
                startAngle: 240,
                indexLabel: "{label} {y}",
                dataPoints: [
                    { y: @achievedtotal, label: "Achieved" },
                    { y: @yettoachieve, label: "Yet To Achieve" }
                ]
            }]
        });
        chart5.render();
    </script>
}

